<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.24.xsd">

    <changeSet id="016-001" author="dms">
        <preConditions onFail="MARK_RAN" onError="HALT">
            <not>
                <tableExists tableName="system_health_checks"/>
            </not>
        </preConditions>
        <comment>Create system_health_checks table if missing</comment>
        <createTable tableName="system_health_checks">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="check_name" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="check_type" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="response_time_ms" type="BIGINT"/>
            <column name="error_message" type="TEXT"/>
            <column name="check_data" type="TEXT"/>
            <column name="threshold_value" type="NUMERIC(15,2)"/>
            <column name="actual_value" type="NUMERIC(15,2)"/>
            <column name="severity" type="VARCHAR(20)"/>
            <column name="component" type="VARCHAR(100)"/>
            <column name="service" type="VARCHAR(100)"/>
            <column name="environment" type="VARCHAR(50)"/>
            <column name="executed_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="next_check_at" type="TIMESTAMP"/>
            <column name="check_interval_seconds" type="INTEGER" defaultValueNumeric="300"/>
            <column name="is_enabled" type="BOOLEAN" defaultValueBoolean="true"/>
            <column name="retry_count" type="INTEGER" defaultValueNumeric="0"/>
            <column name="max_retries" type="INTEGER" defaultValueNumeric="3"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

</databaseChangeLog>

